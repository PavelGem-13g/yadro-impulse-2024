# yadro-impulse-2025

Подготовил Пашенцев Павел Владимирович

# Задание
Дано следующее математическое выражение: 

![](/media/qtask.png)

1.	Нарисуйте в любом графическом редакторе цифровую схему, реализующую вычисление заданного выражения (Visio, draw.io или аналогичный)
2.	Используя любой HDL язык (Verilog, SystemVerilog, VHDL) опишите цифровую схему, отвечающую заданным требованиям:
3.	входные параметры a, b, c, d являются целыми числами со знаком (signed)
4.	набор параметров a, b, c, d должен подаваться на вход схемы синхронно 
5.	разрядность данных должна определяться параметром
6.	схема должна обеспечивать возможность получения нового набора входных параметров a, b, c, d каждый такт
7.	латентность схемы должна быть оптимальной
8.	по возможности реализовать подтверждение входных и выходных данных сигналом valid
9.	Верифицируйте описанную схему с помощью testbench. В качестве симулятора можно использовать САПР Vivado, ModelSim или аналогичный
10.	Для проверки корректности работы схемы и testbench, разработайте программу на Python, решающую заданное математическое выражение
11.	Описать возможные способы защиты от ошибок переполнения разрядной сетки
При наличии инструментальной возможности (оценивается отдельно):
12.	Оценить аппаратный ресурс, требуемый для реализации схемы по результатам синтеза, выполненного в САПР Vivado или Quartus
13.	Оценить максимальную тактовую частоту работы схемы


# Выполнение

## Схема цифрового устройства

Составим цифровую схему требуемого устройства (рис. 1). Заметим, что некоторые блоки можно вычислять параллельно.

![Рисунок 1. Схема устройства](/media/yadro_scheme.png)
 
## Описание цифровой схемы

Теперь напишем код модуля ([Q_calculator.sv](/qurtus/TestTask/Q_calculator.sv)) на языке System Verilog для реализации цифровой схемы. Имеются 4 входа (a, b, c, d) и один выход функции в соответствии заданию. 
После компиляции получим следующую RTL-модель (рис. 2).
 
![Рисунок 2. RTL-модель](/media/yadro_rtl.png)

## Обязательные требования входных значений

Входные параметры a, b, c, d объявлены как знаковые числа (пункт 3), подаются синхронно по сигналу valid_in (пункт 4), что обеспечивает одновременную обработку всего набора. Разрядность данных задаётся параметром WIDTH, позволяя гибко адаптировать модуль под нужную точность (пункт 5).

## Дополнительные требования входных значений

Схема реализована как конвейер с тремя стадиями и поддержкой сигнала valid, что позволяет принимать новый набор параметров a, b, c, d на каждом такте (пункт 6). Латентность сведена к минимуму за счёт распараллеливания операций по стадиям (пункт 7), а сигналы valid_in и valid_out обеспечивают подтверждение актуальности входных и выходных данных (пункт 8).

## Верификация модуля

Был разработан тестбенч для проверки работы разрабатываемого модуля ([tb_Q_calculator.sv](/qurtus/TestTask/tb_Q_calculator.sv)). Waveform-диаграмма приведена на рисунке 3. На рисунке 4 приведен текстовый отчет пройденных тестов.
 
![Рисунок 3. Waveform диаграмма тестбенча](/media/yadro_modelsim.png)
 
![Рисунок 4. Текстовый отчет](/media/yadro_text.png)

## Проверка корректности верификации

Для проверки корректности верификационного модуля был написан скрипт на Python ([main.py](/python/main.py)) для проверки входного вектора и выходного значения. Также был сформирован файл тестирующей выборки для дальнейшей верификации ([Tests.csv](/python/Tests.csv)),  выборка из этого файла представлена на рисунке 5. При сравнении выборок можено сделать вывод, что спроектирована верная схема.
 
![Рисунок 5. Выборка из Tests.csv](/media/yadro_tests.png)

## Возможные способы защиты

В коде защита от переполнения достигается расширением разрядности: все промежуточные операции выполняются в удвоенной ширине EXT = 2 * WIDTH, что предотвращает потерю значащих битов. Дополнительно можно реализовать проверку старших битов или флаг переполнения для контроля ошибок.

## Оценка аппаратных ресурсов

В качестве аппаратной платформы была выбрана плата DE10-Lite с чипом 10M50DAF484C7G. Для оценки работы потребовалось скомпилировать проект (рис. 6). 

По результатам синтеза итоговая схема использует всего 98 логических элементов из 49 760 (<1 %), 81 регистр и 2 встроенных 9-битных умножителя из 288 (<1 %). Это означает, что схема занимает крайне малую часть доступных ресурсов, оставляя большой запас для дальнейшего расширения или интеграции с другими модулями. Память, PLL, UFM и другие блоки не используются.
 
![Рисунок 6. Результат компиляции](/media/yadro_compilation.png)

## Оценка максимальной тактовой частоты 

Для оценки максимальной тактовой частоты использовался TimeQuest Timing Analyzer. Максимальная тактовая частота была получена при помощи Fmax Summary (рис. 7). Также можно проанализировать распространение сигнала внутри схемы (рис. 8) при помощи Report Clocks.  
 
![Рисунок 7. Максимальная тактовая частота](/media/yadro_fmax.png)
 
![Рисунок 8. Распостранение сигнала в схеме](/media/yadro_reportclock.png)

## Выводы

В рамках задания была разработана цифровая схема для вычисления заданного выражения с параметризуемой разрядностью и синхронной подачей входных данных. Схема реализована на SystemVerilog в виде трёхстадийного конвейера с поддержкой сигналов valid и защитой от переполнения за счёт расширения разрядности. Проведена верификация с помощью тестбенча и Python-скрипта, подтверждающая корректность работы. Синтез показал минимальное использование аппаратных ресурсов и высокую максимальную тактовую частоту.
